<html>
	<head>
		<script type="text/javascript" src="../src/debug/d8.js"></script>
        <script type="text/javascript" src="../src/debug/o3.js"></script>
        
        <script type="text/javascript" src="../src/ace/lib/core.js"></script>
        <script type="text/javascript" src="../src/ace/lib/oop.js"></script>
        <script type="text/javascript" src="../src/ace/lib/lang.js"></script>
        <script type="text/javascript" src="../src/ace/MEventEmitter.js"></script>
        
        <script type="text/javascript" src="../src/debug/O3Socket.js"></script>
        <script type="text/javascript" src="../src/debug/V8DebugMessageStream.js"></script>
        <script type="text/javascript" src="../src/debug/DevToolsService.js"></script>
        <script type="text/javascript" src="../src/debug/DevToolsMessage.js"></script>
        <script type="text/javascript" src="../src/debug/V8DebuggerService.js"></script>
        <script type="text/javascript" src="../src/debug/V8Debugger.js"></script>
        <script type="text/javascript" src="../src/debug/V8Message.js"></script>
	</head>
	<body>
		<embed type="application/o3stem-aaaaaaaa-1111-bbbb-1111-cccccccccccc" width="0" height="0" /> 

        <button onClick="testChrome()">start test</button>
	</body>
	<script>

function testChrome() {
    var o3obj = document.getElementsByTagName("embed")[0];
	var socket = new O3Socket("127.0.0.1", 9222, o3obj);
	var msgStream = new V8DebugMessageStream(socket);

	msgStream.addEventListener("connect", function() {

		var dts = new DevToolsService(msgStream);
		var v8ds = new V8DebuggerService(msgStream);
		
		dts.getVersion(function(version) {
			console.log("ChromeDevTools Version:", version);

			dts.listTabs(function(tabs) {
				console.log(tabs);

				var tabId = tabs[0][0];
				v8ds.attach(tabId, function() {
					console.log("attached");

					var v8debugger = new V8Debugger(tabId, v8ds);
					v8debugger.version(function(version) {
						console.log("V8 version:", version.V8Version);
					});

					v8debugger.scripts(4, null, false, function(scripts) {
						console.log("scripts (short)", scripts);
						v8debugger.scripts(4, [scripts[0].id], true, function(scripts) {
							console.log("scripts (full)", scripts);
						});
					});
				});			
			});
		});
	});
	
	msgStream.connect();
};
    </script>
</html>
